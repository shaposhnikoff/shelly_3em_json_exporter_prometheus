modules:
  shelly_3em:
    metrics:
      # Cloud connection status
      - name: shelly_cloud_connected
        type: object
        help: Cloud connection status
        path: '{.cloud}'
        labels:
          mac: '{.sys.mac}'
        values:
          connected: '{.connected}'

      # Phase A metrics
      - name: shelly_phase_a_current_amperes
        type: object
        help: Phase A current in amperes
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'a'
        values:
          current: '{.a_current}'

      - name: shelly_phase_a_voltage_volts
        type: object
        help: Phase A voltage in volts
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'a'
        values:
          voltage: '{.a_voltage}'

      - name: shelly_phase_a_active_power_watts
        type: object
        help: Phase A active power in watts
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'a'
        values:
          power: '{.a_act_power}'

      - name: shelly_phase_a_apparent_power_va
        type: object
        help: Phase A apparent power in VA
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'a'
        values:
          power: '{.a_aprt_power}'

      - name: shelly_phase_a_power_factor
        type: object
        help: Phase A power factor
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'a'
        values:
          pf: '{.a_pf}'

      - name: shelly_phase_a_frequency_hertz
        type: object
        help: Phase A frequency in Hz
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'a'
        values:
          frequency: '{.a_freq}'

      # Phase B metrics
      - name: shelly_phase_b_current_amperes
        type: object
        help: Phase B current in amperes
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'b'
        values:
          current: '{.b_current}'

      - name: shelly_phase_b_voltage_volts
        type: object
        help: Phase B voltage in volts
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'b'
        values:
          voltage: '{.b_voltage}'

      - name: shelly_phase_b_active_power_watts
        type: object
        help: Phase B active power in watts
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'b'
        values:
          power: '{.b_act_power}'

      - name: shelly_phase_b_apparent_power_va
        type: object
        help: Phase B apparent power in VA
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'b'
        values:
          power: '{.b_aprt_power}'

      - name: shelly_phase_b_power_factor
        type: object
        help: Phase B power factor
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'b'
        values:
          pf: '{.b_pf}'

      - name: shelly_phase_b_frequency_hertz
        type: object
        help: Phase B frequency in Hz
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'b'
        values:
          frequency: '{.b_freq}'

      # Phase C metrics
      - name: shelly_phase_c_current_amperes
        type: object
        help: Phase C current in amperes
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'c'
        values:
          current: '{.c_current}'

      - name: shelly_phase_c_voltage_volts
        type: object
        help: Phase C voltage in volts
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'c'
        values:
          voltage: '{.c_voltage}'

      - name: shelly_phase_c_active_power_watts
        type: object
        help: Phase C active power in watts
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'c'
        values:
          power: '{.c_act_power}'

      - name: shelly_phase_c_apparent_power_va
        type: object
        help: Phase C apparent power in VA
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'c'
        values:
          power: '{.c_aprt_power}'

      - name: shelly_phase_c_power_factor
        type: object
        help: Phase C power factor
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'c'
        values:
          pf: '{.c_pf}'

      - name: shelly_phase_c_frequency_hertz
        type: object
        help: Phase C frequency in Hz
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'c'
        values:
          frequency: '{.c_freq}'

      # Total metrics
      - name: shelly_total_current_amperes
        type: object
        help: Total current in amperes
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
        values:
          current: '{.total_current}'

      - name: shelly_total_active_power_watts
        type: object
        help: Total active power in watts
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
        values:
          power: '{.total_act_power}'

      - name: shelly_total_apparent_power_va
        type: object
        help: Total apparent power in VA
        path: '{.em:0}'
        labels:
          mac: '{.sys.mac}'
        values:
          power: '{.total_aprt_power}'

      # Energy counters
      - name: shelly_phase_a_total_active_energy_wh
        type: object
        help: Phase A total active energy in Wh
        path: '{.emdata:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'a'
        values:
          energy: '{.a_total_act_energy}'

      - name: shelly_phase_b_total_active_energy_wh
        type: object
        help: Phase B total active energy in Wh
        path: '{.emdata:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'b'
        values:
          energy: '{.b_total_act_energy}'

      - name: shelly_phase_c_total_active_energy_wh
        type: object
        help: Phase C total active energy in Wh
        path: '{.emdata:0}'
        labels:
          mac: '{.sys.mac}'
          phase: 'c'
        values:
          energy: '{.c_total_act_energy}'

      - name: shelly_total_active_energy_wh
        type: object
        help: Total active energy in Wh
        path: '{.emdata:0}'
        labels:
          mac: '{.sys.mac}'
        values:
          energy: '{.total_act}'

      # System metrics
      - name: shelly_uptime_seconds
        type: object
        help: Device uptime in seconds
        path: '{.sys}'
        labels:
          mac: '{.mac}'
        values:
          uptime: '{.uptime}'

      - name: shelly_ram_free_bytes
        type: object
        help: Free RAM in bytes
        path: '{.sys}'
        labels:
          mac: '{.mac}'
        values:
          ram_free: '{.ram_free}'

      - name: shelly_temperature_celsius
        type: object
        help: Device temperature in Celsius
        path: '{.temperature:0}'
        labels:
          mac: '{.sys.mac}'
        values:
          temperature: '{.tC}'

      # WiFi metrics
      - name: shelly_wifi_rssi_dbm
        type: object
        help: WiFi RSSI in dBm
        path: '{.wifi}'
        labels:
          mac: '{.sys.mac}'
          ssid: '{.ssid}'
        values:
          rssi: '{.rssi}'

      - name: shelly_wifi_status
        type: object
        help: WiFi connection status (1 = got ip, 0 = other)
        path: '{.wifi}'
        labels:
          mac: '{.sys.mac}'
          ssid: '{.ssid}'
        values:
          status: '{.status}'

      # MQTT connection status
      - name: shelly_mqtt_connected
        type: object
        help: MQTT connection status
        path: '{.mqtt}'
        labels:
          mac: '{.sys.mac}'
        values:
          connected: '{.connected}'

